<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8" />
  <title>Lottie Previewer</title>
  <style>
    body {
      background-color: #ffffff;
      margin: 0px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    #lottie {
      width: 512px;
      height: 512px;
      background-color: #ffffff;
      position: relative;
      border: 1px solid #eee;
    }
    .drop-zone {
      border: 2px dashed #ccc;
      border-radius: 8px;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      position: absolute;
      z-index: 1;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }
    .drop-zone.dragover {
      background: rgba(0,0,0,0.1);
      border-color: #666;
    }
    .drop-text {
      font-family: Arial, sans-serif;
      color: #666;
      font-size: 1.2em;
      pointer-events: none;
    }
    #controls {
      margin-top: 20px;
      padding: 10px;
      background: #f5f5f5;
      display: flex;
      gap: 10px;
      justify-content: center;
      border-radius: 4px;
    }
    button {
      padding: 5px 15px;
      cursor: pointer;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
    }
    button:hover {
      background: #f0f0f0;
    }
  </style>
</head>
<body>
  <div id="lottie">
    <div class="drop-zone">
      <span class="drop-text">拖拽 Lottie JSON 文件到这里</span>
    </div>
  </div>
  <div id="controls">
    <button id="playPause">播放/暂停</button>
    <button id="stop">停止</button>
    <button id="speedUp">加速</button>
    <button id="speedDown">减速</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/lottie-web@5.12.2/build/player/lottie.min.js"></script>
  <script>
    let anim = null;
    const dropZone = document.querySelector('.drop-zone');
    const playPauseBtn = document.getElementById('playPause');
    const stopBtn = document.getElementById('stop');
    const speedUpBtn = document.getElementById('speedUp');
    const speedDownBtn = document.getElementById('speedDown');

    // 阻止默认拖放行为
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      document.body.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    // 拖拽效果
    ['dragenter', 'dragover'].forEach(eventName => {
      dropZone.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
      dropZone.classList.add('dragover');
    }

    function unhighlight(e) {
      dropZone.classList.remove('dragover');
    }

    // 处理文件拖放
    dropZone.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      handleFiles(files);
    }

    function handleFiles(files) {
      if (files.length > 0) {
        const file = files[0];
        if (file.type === "application/json" || file.name.endsWith('.json')) {
          const reader = new FileReader();
          reader.onload = function(e) {
            try {
              const jsonData = JSON.parse(e.target.result);
              loadAnimation(jsonData);
            } catch (error) {
              alert('JSON 文件格式错误');
            }
          };
          reader.readAsText(file);
        } else {
          alert('请拖入 JSON 文件');
        }
      }
    }

    function loadAnimation(animationData) {
      // 如果已有动画，先销毁
      if (anim) {
        anim.destroy();
      }

      const params = {
        container: document.getElementById('lottie'),
        renderer: 'svg',
        loop: true,
        autoplay: true,
        animationData: animationData
      };

      anim = lottie.loadAnimation(params);
      dropZone.style.display = 'none';
    }

    // 控制按钮事件
    playPauseBtn.addEventListener('click', () => {
      if (!anim) return;
      if (anim.isPaused) {
        anim.play();
      } else {
        anim.pause();
      }
    });

    stopBtn.addEventListener('click', () => {
      if (!anim) return;
      anim.stop();
    });

    speedUpBtn.addEventListener('click', () => {
      if (!anim) return;
      anim.setSpeed(anim.playSpeed + 0.5);
    });

    speedDownBtn.addEventListener('click', () => {
      if (!anim) return;
      anim.setSpeed(Math.max(0.5, anim.playSpeed - 0.5));
    });
  </script>
</body>
</html>