// https://cdn.oaistatic.com/assets/cimgp761aqxyexnh.js
const Hr=2,Wr=({viewport:e,canvasSize:n,shouldMeasurePerf:t,source:o})=>{const r=l.useRef({}),i=l.useCallback((a)=>{const s=a.getExtension("WEBGL_debug_renderer_info");s&&((r.current.vendor=a.getParameter(s.UNMASKED_VENDOR_WEBGL)),(r.current.renderer=a.getParameter(s.UNMASKED_RENDERER_WEBGL)))},[]);return(l.useEffect(()=>{const a={vendor:r.current.vendor??"(unavailable)",renderer:r.current.renderer??"(unavailable)",width:e[0],height:e[1],canvasWidth:n[0],canvasHeight:n[1],dpr:window.devicePixelRatio,source:o,};!Pt(a,r.current)&&t&&((r.current=a),Nn(Hr).then((c)=>{D.bloop.performance({...a,fps:c})}))},[n,t,e,o]),i)},$r=0.25,Gr=3,gn=28,Pe=55,Re=200,bn=1.1,Yr=({viewport:e,initialScale:n,shouldCalibrate:t})=>{const[o,r]=l.useState(n),i=l.useRef(void 0),a=l.useRef(void 0),s=l.useRef(void 0),c=l.useRef("down"),u=l.useCallback(()=>{const f=c.current==="up"?Gr:$r;Nn(f).then((m)=>{if(m<gn){c.current="down";const b=Math.max(m,1),d=Math.sqrt(b/gn);r((h)=>h*d),(a.current=window.setTimeout(u,Re))}else if(s.current){const b=m>=Pe,d=m>=s.current*bn;if(b||d)(c.current="up"),r((h)=>h*bn),(a.current=window.setTimeout(u,Re));else if(m<Pe){c.current="down";const h=Math.sqrt(m/Pe);r((p)=>p*h)}}s.current=m})},[]);return(l.useEffect(()=>{const[f,m]=e,[b,d]=i.current??[];return(t&&(b!==f||d!==m)&&((i.current=e),clearTimeout(a.current),r(n),(a.current=window.setTimeout(u,Re))),()=>{clearTimeout(a.current)})},[t,u,n,e]),o)},Xr=60,ke=Math.floor(1e3/Xr);var Kr=Rt,Jr=Lt,Qr=Nt,Zr=Ft,ei=Wt,ni=Math.max;function ti(e){if(!(e&&e.length))return[];var n=0;return((e=Kr(e,function(t){if(ei(t))return(n=ni(t.length,n)),!0})),Zr(n,function(t){return Jr(e,Qr(t))}))}var oi=ti,ri=$t,ii=oi,ai=ri(ii),si=ai;const Fe=kt(si),Xe=240,ht=2048,mt=new Array(Xe).fill(0),ci=(e)=>{const n=kr(e,{bands:Xe,updateInterval:ke,loPass:0,hiPass:400,analyserOptions:{fftSize:ht}});return n.length===0?mt:n},Ke=(e)=>{const{magnitudes:n,binCount:t,gainMultiplier:o}=e;if(n.length===0)return new Array(t).fill(0);const r=Math.ceil(n.length/t),i=[];for(let a=0;a<n.length;a+=r){const s=Math.min(a+r,n.length),c=n.slice(a,s).sort((b,d)=>b-d),u=Math.floor(c.length/2);let f;c.length%2===0?(f=(c[u-1]+c[u])/2):(f=c[u]),(f=Math.abs(f)),(f*=o);const m=f/(f+1);i.push(m)}return i},gt=(e,n)=>{const t=n.sampleRate,o=e.length,r=n.bandCount,i=n.binCount,a=n.gainMultipliers;if(a.length!==r)throw new Error("gainMultipliers must have length equal to bandCount");const s=o*2,c=t/s,u=e.map((h,p)=>p*c),f=20,m=t/2,b=new Array(r+1).fill(0).map((h,p)=>f*Math.pow(m/f,p/r)),d=new Array(r).fill(null).map(()=>[]);for(let h=0;h<u.length;h+=1)for(let p=0;p<r;p+=1)if(u[h]>=b[p]&&u[h]<b[p+1]){d[p].push(e[h]);break}for(let h=0;h<r;h+=1){const p=d[h],g=a[h];d[h]=Ke({magnitudes:p,binCount:i,gainMultiplier:g})}return d},yn=60,bt=48e3,ui=1,li=2,di=40,fi=2;function Sn({time:e,timeConstant:n}){return 1-Math.exp(-e/n)}function wn(e,n){const t=n[1]-n[0];return n[0]+e*t}const Le=(e)=>{if(!Array.isArray(e)||e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error("zip failed - received a value that is not a [number, number] tuple");},pi=(e)=>{const{prevAudioData:n,prevCumulativeAudioData:t,deltaTimeS:o,audioDataRaw:r}=e,i=r.map((b)=>b*o*yn*ui),a=Sn({time:o,timeConstant:li}),s=Fe(n,i).map((b)=>(Le(b),wn(a,b))),c=r.map((b)=>b*o*yn*di),u=Fe(t,c).map((b)=>(Le(b),b[0]+b[1])),f=Sn({time:o,timeConstant:fi}),m=Fe(t,u).map((b)=>(Le(b),wn(f,b)));return{audioData:s,cumulativeAudioData:m}},ia=(e,n)=>{const t=ci(e),o=gt(t,{sampleRate:bt,binCount:n.bins,bandCount:n.bands,gainMultipliers:n.gainMultipliers}),r=Ke({magnitudes:t,binCount:1,gainMultiplier:1});return{bandMagnitudes:o,cumulativeMagnitude:r}},oe=ee.createChild("GLCanvas");function vi({className:e,vert:n,frag:t,Behaviors:o,onViewportUpdate:r,onRenderComplete:i,onGlAvailable:a,onCanvasSizeUpdate:s,scale:c}){const u=l.useRef(null),f=l.useRef(null),[m,b]=l.useState(null),[d,h]=l.useState(),p=l.useRef(Gt((y)=>{const{width:S,height:_}=y.contentRect,x=Math.floor(Math.min(S??0,_??0));b(x),r?.({width:x,height:x})},100)),g=Yt(p.current);if((an(()=>{const y=u.current,{width:S,height:_}=y??{};if(y&&m!=null&&S&&_){const x=y.getContext("webgl2",{premultipliedAlpha:!0});x?h(x):oe.error("webgl2 context not supported")}},[m]),an(()=>{if(!d)return;const y=d.createProgram(),S=d.createShader(d.VERTEX_SHADER),_=d.createShader(d.FRAGMENT_SHADER);if(!y){oe.debug("failed to create program");return}if(!S||!_){oe.debug("failed to create shaders",S,_);return}let x="";if((d.shaderSource(S,n),d.compileShader(S),(x+=`vertShader:${d.getShaderInfoLog(S)}`),d.attachShader(y,S),d.shaderSource(_,t),d.compileShader(_),(x+=`fragShader:${d.getShaderInfoLog(_)}`),d.attachShader(y,_),d.linkProgram(y),d.useProgram(y),(x+=d.getProgramInfoLog(y)),!d.getProgramParameter(y,d.LINK_STATUS)))throw`Could not compile WebGL program.${x}`;(f.current=y),oe.debug("program created"),a?.(d,y);const k=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);return(k&&(d.waitSync(k,0,d.TIMEOUT_IGNORED),i?.()),()=>{oe.debug("cleaning up"),(f.current=null),d.detachShader(y,S),d.detachShader(y,_),d.deleteShader(S),d.deleteShader(_),d.deleteProgram(y)})},[d,t,n]),m!=null&&d&&u.current)){const y=u.current,S=m*window.devicePixelRatio*(c??1);(y.width=S),(y.height=S),d.viewport(0,0,S,S),s?.({width:S,height:S})}const v=f.current;return w.jsxs("div",{className:e,ref:g,children:[w.jsx("canvas",{ref:u,style:{width:m??void 0,height:m??void 0}},m),d&&v&&o&&w.jsx(o,{ctx:d,program:v})],})}function hi({GLUniformsSetter:e,textureImage:n,textureName:t,variablesRef:o,className:r,vert:i,frag:a,onViewportUpdate:s,onRenderComplete:c,onGlAvailable:u,onCanvasSizeUpdate:f,scale:m,}){const b=l.useRef(void 0),d=l.useCallback(async(g,v)=>{if(((b.current=new e(g,v)),n&&t)){const y=g.createTexture();g.bindTexture(g.TEXTURE_2D,y),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,n);const S=g.getUniformLocation(v,t);g.activeTexture(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,y),g.uniform1i(S,0)}u?.(g,v)},[e,n,t,u]),h=l.useRef(void 0),p=l.useCallback(()=>{b.current&&o.current&&b.current.setVariablesAndRender(o.current),(h.current=requestAnimationFrame(p))},[o]);return(l.useEffect(()=>(p(),()=>{h.current&&cancelAnimationFrame(h.current)}),[p]),w.jsx(vi,{className:r,vert:i,frag:a,onViewportUpdate:s,onRenderComplete:c,onGlAvailable:d,onCanvasSizeUpdate:f,scale:m,Behaviors:()=>null,}))}const mi="webp",gi=512,bi=512,yi="srgb",Si=3,wi="uchar",xi=72,Ci=!1,Ai=8,Ti=!1,_i=!1,ki="https://cdn.oaistatic.com/assets/noise-watercolor-m3j88gni.webp",Ei={format:mi,width:gi,height:bi,space:yi,channels:Si,depth:wi,density:xi,isProgressive:Ci,paletteBitDepth:Ai,hasProfile:Ti,hasAlpha:_i,src:ki,};let yt;const _e=new window.Image();_e.crossOrigin="anonymous";_e.src=Ei.src;_e.onload=()=>{yt=_e};var Di=`#version 300 es#define E(2.71828182846)#define pi(3.14159265358979323844)#define NUM_OCTAVES(4)precision highp float;struct ColoredSDF{float distance;vec4 color};struct SDFArgs{vec2 st;float amount;float duration;float time;float mainRadius};float triangle(float t,float p){return 2.0*abs(t/p-floor(t/p+0.5))}float spring(float t,float d){return 1.0-exp(-E*2.0*t)*cos((1.0-d)*115.0*t)}float silkySmooth(float t,float k){return atan(k*sin((t-0.5)*pi))/atan(k)*0.5+0.5}float scaled(float edge0,float edge1,float x){return clamp((x-edge0)/(edge1-edge0),float(0),float(1))}float fixedSpring(float t,float d){float s=mix(1.0-exp(-E*2.0*t)*cos((1.0-d)*115.0*t),1.0,scaled(0.0,1.0,t));return s*(1.0-t)+t}float bounce(float t,float d){return-sin(pi*(1.0-d)*t)*(1.0-t)*exp(-2.71828182846*2.0*t)*t*10.0}float random(vec2 st){return fract(sin(dot(st.xy,vec2(12.9898,78.233)))*43758.5453123)}float random(ivec2 st){return random(vec2(st))}float random(float p){return random(vec2(p))}float opSmoothUnion(float d1,float d2,float k){if(k<=0.0){k=0.000001}float h=clamp(0.5+0.5*(d2-d1)/k,0.0,1.0);return mix(d2,d1,h)-k*h*(1.0-h)}float opSmoothSubtraction(float d1,float d2,float k){if(k<=0.0){k=0.000001}float h=clamp(0.5-0.5*(d2+d1)/k,0.0,1.0);return mix(d2,-d1,h)+k*h*(1.0-h)}float opSmoothIntersection(float d1,float d2,float k){if(k<=0.0){k=0.000001}float h=clamp(0.5-0.5*(d2-d1)/k,0.0,1.0);return mix(d2,d1,h)+k*h*(1.0-h)}float sdRoundedBox(vec2 p,vec2 b,vec4 r){r.xy=p.x>0.0?r.xy:r.zw;r.x=p.y>0.0?r.x:r.y;vec2 q=abs(p)-b+r.x;return min(max(q.x,q.y),0.0)+length(max(q,0.0))-r.x}float sdSegment(vec2 p,vec2 a,vec2 b){vec2 pa=p-a;vec2 ba=b-a;float h=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-ba*h)}float sdArc(vec2 p,vec2 sca,vec2 scb,float ra,float rb){p*=mat2(sca.x,sca.y,-sca.y,sca.x);p.x=abs(p.x);return scb.y*p.x>scb.x*p.y?length(p-ra*scb)-rb:abs(length(p)-ra)-rb}float arc(vec2 st,float startAngle,float length,float radius,float width){return sdArc(st,vec2(sin(startAngle),cos(startAngle)),vec2(sin(length),cos(length)),radius,width)}vec2 rotate(vec2 v,float a){float s=sin(a);float c=cos(a);mat2 m=mat2(c,s,-s,c);return m*v}vec3 blendLinearBurn_13_5(vec3 base,vec3 blend){return max(base+blend-vec3(1.0),vec3(0.0))}vec3 blendLinearBurn_13_5(vec3 base,vec3 blend,float opacity){return blendLinearBurn_13_5(base,blend)*opacity+base*(1.0-opacity)}vec4 permute(vec4 x){return mod((x*34.0+1.0)*x,289.0)}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r}vec3 fade(vec3 t){return t*t*t*(t*(t*6.0-15.0)+10.0)}float cnoise(vec3 P){vec3 Pi0=floor(P);vec3 Pi1=Pi0+vec3(1.0);Pi0=mod(Pi0,289.0);Pi1=mod(Pi1,289.0);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.z);vec4 iz1=vec4(Pi1.z);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0/7.0;vec4 gy0=fract(floor(gx0)/7.0)-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(vec4(0.0),gx0)-0.5);gy0-=sz0*(step(vec4(0.0),gy0)-0.5);vec4 gx1=ixy1/7.0;vec4 gy1=fract(floor(gx1)/7.0)-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(vec4(0.0),gx1)-0.5);gy1-=sz1*(step(vec4(0.0),gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz}float rand(vec2 n){return fract(sin(dot(n,vec2(12.9898,4.1414)))*43758.5453)}float noise(vec2 p){vec2 ip=floor(p);vec2 u=fract(p);u=u*u*(3.0-2.0*u);float res=mix(mix(rand(ip),rand(ip+vec2(1.0,0.0)),u.x),mix(rand(ip+vec2(0.0,1.0)),rand(ip+vec2(1.0,1.0)),u.x),u.y);return res*res}float fbm(vec2 x){float v=0.0;float a=0.5;vec2 shift=vec2(100.0);mat2 rot=mat2(cos(0.5),sin(0.5),-sin(0.5),cos(0.5));for(int i=0;i<NUM_OCTAVES;++i){v+=a*noise(x);x=rot*x*2.0+shift;a*=0.5}return v}ColoredSDF applyIdleState(ColoredSDF sdf,SDFArgs args,bool isDarkMode){float midRadius=0.12;float maxRadius=0.3;float t1=1.0;float gamma=3.0;float omega=pi/2.0;float k=exp(-gamma)*omega;float radius;if(args.time<=t1){float t_prime=args.time/t1;float springValue=1.0-exp(-gamma*t_prime)*cos(omega*t_prime);radius=midRadius*springValue}else{float adjustedTime=args.time-t1;radius=midRadius+(maxRadius-midRadius)*(1.0-exp(-k*adjustedTime))}float distance=length(args.st)-radius;sdf.distance=mix(sdf.distance,distance,args.amount);float alpha=sin(pi/0.7*args.time)*0.3+0.7;vec4 color=vec4(isDarkMode?vec3(1.0):vec3(0.0),alpha);sdf.color=mix(sdf.color,color,args.amount);return sdf}ColoredSDF applyIdleStateLegacy(ColoredSDF sdf,SDFArgs args,bool isDarkMode){float connectedLinearAnimation=scaled(0.0,2.0,args.duration);float connectedAnimation=fixedSpring(connectedLinearAnimation,0.96);float circleSize=mix(pow(scaled(0.0,3.0,args.time),2.0)*0.75+0.1,1.0,connectedAnimation)*0.33;vec2 rotatedCoords=rotate(args.st,-args.time*pi-connectedAnimation*pi*2.0-pi*2.0*5.0*silkySmooth(scaled(0.0,5.0,args.time),2.0));float strokeWidth=mix(circleSize/2.0,circleSize,connectedAnimation);float connecting=abs(length(args.st)-circleSize)-strokeWidth;float connected=length(args.st)-circleSize;float idleDist=mix(connecting,connected,connectedAnimation);float d=min(sdf.distance,idleDist);sdf.distance=mix(sdf.distance,d,args.amount);float angle=atan(rotatedCoords.y,rotatedCoords.x);float alpha=mix(min(1.0,scaled(-pi,pi,angle)),1.0,connectedLinearAnimation);float spinningCircleDist=length(rotatedCoords-vec2(-mix(circleSize,strokeWidth,connectedAnimation),0.0))-strokeWidth;alpha=min(1.0,max(alpha,smoothstep(0.005,0.0,spinningCircleDist)+connectedAnimation*4.0));sdf.color=mix(sdf.color,vec4(isDarkMode?vec3(1.0):vec3(0.0),alpha),args.amount);return sdf}ColoredSDF applyListenState(ColoredSDF sdf,SDFArgs args,float micLevel,float listenTimestamp,float touchDownTimestamp,float touchUpTimestamp,bool fadeBloopWhileListening){float breathingSequence=sin(args.time)*0.5+0.5;float entryAnimation=fixedSpring(scaled(0.0,3.0,args.duration),0.9);float touch=fixedSpring(scaled(0.0,1.0,args.time-touchDownTimestamp),0.99)-fixedSpring(scaled(0.0,0.8,args.time-touchUpTimestamp),1.0);float listenAnimation=clamp(spring(scaled(0.0,0.9,args.duration),1.0),0.0,1.0);float radius=0.0;float smoothlevel=micLevel;float l1=smoothlevel;radius=0.38+l1*0.05+breathingSequence*0.03;radius*=1.0-(1.0-entryAnimation)*0.25;float ring=10000.0;if(touch>0.0){touch=min(touch,listenAnimation);float arcWidth=radius*0.1;radius-=touch*arcWidth*2.3;radius=min(radius,mix(radius,args.mainRadius-arcWidth*2.3-l1*0.01,touch));float startAngle=0.0;float arcLengthTouch=smoothstep(0.04,1.0,touch)*pi*(1.0-arcWidth/3.0/radius);float arcLength=0.0;float radiusTouch=radius*fixedSpring(scaled(0.0,1.0,args.duration),1.0)*args.amount+l1*0.01;radiusTouch+=arcWidth*1.3*mix(-1.0,1.0,smoothstep(0.0,0.12,touch));float ringRadius=0.0;arcLength=arcLengthTouch;ringRadius=radiusTouch;startAngle=pi/2.0-(args.time-touchDownTimestamp)/2.0;ring=arc(args.st,startAngle,arcLength,ringRadius,arcWidth)}float d=length(args.st)-radius;d=min(d,ring);sdf.distance=mix(sdf.distance,d,args.amount);if(fadeBloopWhileListening){sdf.color.a=mix(sdf.color.a,mix(1.0,1.0-l1*0.6,listenAnimation),args.amount)}else{sdf.color.a=1.0}return sdf}ColoredSDF applyThinkState(ColoredSDF sdf,SDFArgs args){float d=1000.0;int count=5;float entryAnimation=spring(scaled(0.0,1.0,args.duration),1.0);float thinkingDotEntryAnimation=spring(scaled(0.1,1.1,args.duration),1.0);float thinkingDotRadius=mix(0.2,0.06,thinkingDotEntryAnimation)*args.amount;args.st.x-=thinkingDotRadius*0.5*thinkingDotEntryAnimation;for(int i=0;i<count;i++){float f=float(float(i)+0.5)/float(count);float a=-f*pi*2.0+args.time/3.0+spring(scaled(0.0,10.0,args.duration),1.0)*pi/2.0;float ringRadi=args.mainRadius*0.45*entryAnimation;ringRadi-=(sin(entryAnimation*pi*4.0+a*pi*2.0+args.time*3.0-silkySmooth(args.time/4.0,2.0)*pi*1.0)*0.5+0.5)*args.mainRadius*0.1;vec2 pos=vec2(cos(a),sin(a))*ringRadi;float dd=length(args.st-pos)-args.mainRadius*0.5;d=opSmoothUnion(d,dd,0.03*scaled(0.0,10.0,args.duration)+0.8*(1.0-entryAnimation));float dotAngle=f*pi*2.0;float dotRingRadius=(sin(thinkingDotEntryAnimation*pi*4.0+a*pi*2.0+args.time*0.1*pi*4.0)*0.5+0.5)*thinkingDotRadius*0.3;vec2 dotPos=vec2(-args.mainRadius,args.mainRadius)*0.8*thinkingDotEntryAnimation;vec2 dotOffset=vec2(cos(dotAngle+args.time),sin(dotAngle+args.time))*dotRingRadius;float dotD=length(args.st-dotPos-dotOffset)-thinkingDotRadius*0.8;d=opSmoothUnion(d,dotD,(1.0-min(thinkingDotEntryAnimation,args.amount))*thinkingDotRadius)}sdf.distance=mix(sdf.distance,d,args.amount);sdf.color.a=1.0;return sdf}ColoredSDF applySpeakState(ColoredSDF sdf,SDFArgs args,vec4 avgMag,float silenceAmount,float silenceDuration){float d=1000.0;int barCount=4;for(int i=0;i<barCount;i++){float f=float(float(i)+0.5)/float(barCount);float w=1.0/float(barCount)*0.44;float h=w;float wave=sin(f*pi*0.8+args.time)*0.5+0.5;float entryAnimation=spring(scaled(0.1+wave*0.4,1.0+wave*0.4,args.duration),0.98);vec2 pos=vec2(f-0.5,0.0)*args.mainRadius*1.9;pos.y=0.25*(1.0-entryAnimation);if(silenceAmount>0.0){float bounceStagger=f/5.0;float bounceDelay=0.6;float bounceTimer=scaled(bounceDelay,bounceDelay+1.0,fract((silenceDuration+bounceStagger)/2.0)*2.0);pos.y+=bounce(bounceTimer,6.0)*w*0.25*silenceAmount*pow(entryAnimation,4.0)*pow(args.amount,4.0)}h+=avgMag[i]*(0.1+(1.0-abs(f-0.5)*2.0)*0.1);float dd=sdRoundedBox(args.st-pos,vec2(w,h),vec4(w));d=opSmoothUnion(d,dd,0.2*(1.0-args.amount))}sdf.distance=mix(sdf.distance,d,args.amount);sdf.color.a=1.0;return sdf}ColoredSDF applyListenAndSpeakState(ColoredSDF sdf,SDFArgs args,float micLevel,vec4 avgMag,vec4 cumulativeAudio,int binCount,vec3 bloopColorMain,vec3 bloopColorLow,vec3 bloopColorMid,vec3 bloopColorHigh,sampler2D uTextureNoise,bool listening,bool isAdvancedBloop){float entryAnimation=fixedSpring(scaled(0.0,2.0,args.duration),0.92);float radius=(listening?0.37:0.43)*(1.0-(1.0-entryAnimation)*0.25)+micLevel*0.065;float maxDisplacement=0.01;float oscillationPeriod=4.0;float displacementOffset=maxDisplacement*sin(2.0*pi/oscillationPeriod*args.time);vec2 adjusted_st=args.st-vec2(0.0,displacementOffset);if(!isAdvancedBloop){sdf.color=mix(sdf.color,vec4(bloopColorMain,1.0),args.amount);sdf.distance=mix(sdf.distance,length(adjusted_st)-radius,args.amount);return sdf}vec4 uAudioAverage=avgMag;vec4 uCumulativeAudio=cumulativeAudio;float scaleFactor=1.0/(2.0*radius);vec2 uv=adjusted_st*scaleFactor+0.5;uv.y=1.0-uv.y;float noiseScale=1.25;float windSpeed=0.075;float warpPower=0.19;float waterColorNoiseScale=18.0;float waterColorNoiseStrength=0.01;float textureNoiseScale=1.0;float textureNoiseStrength=0.08;float verticalOffset=0.09;float waveSpread=1.0;float layer1Amplitude=1.0;float layer1Frequency=1.0;float layer2Amplitude=1.0;float layer2Frequency=1.0;float layer3Amplitude=1.0;float layer3Frequency=1.0;float fbmStrength=1.0;float fbmPowerDamping=0.55;float overallSoundScale=1.0;float blurRadius=1.0;float timescale=1.0;float time=args.time*timescale*0.85;vec3 sinOffsets=vec3(uCumulativeAudio.x*0.15*overallSoundScale,-uCumulativeAudio.y*0.5*overallSoundScale,uCumulativeAudio.z*1.5*overallSoundScale);verticalOffset+=1.0-waveSpread;float noiseX=cnoise(vec3(uv*1.0+vec2(0.0,74.8572),(time+uCumulativeAudio.x*0.05*overallSoundScale)*0.3));float noiseY=cnoise(vec3(uv*1.0+vec2(203.91282,10.0),(time+uCumulativeAudio.z*0.05*overallSoundScale)*0.3));uv+=vec2(noiseX*2.0,noiseY)*warpPower;float noiseA=cnoise(vec3(uv*waterColorNoiseScale+vec2(344.91282,0.0),time*0.3))+cnoise(vec3(uv*waterColorNoiseScale*2.2+vec2(723.937,0.0),time*0.4))*0.5;uv+=noiseA*waterColorNoiseStrength;uv.y-=verticalOffset;vec2 textureUv=uv*textureNoiseScale;float textureSampleR0=texture(uTextureNoise,textureUv).r;float textureSampleG0=texture(uTextureNoise,vec2(textureUv.x,1.0-textureUv.y)).g;float textureNoiseDisp0=mix(textureSampleR0-0.5,textureSampleG0-0.5,(sin(time+uCumulativeAudio.a*2.0)+1.0)*0.5)*textureNoiseStrength;textureUv+=vec2(63.861+uCumulativeAudio.x*0.05,368.937);float textureSampleR1=texture(uTextureNoise,textureUv).r;float textureSampleG1=texture(uTextureNoise,vec2(textureUv.x,1.0-textureUv.y)).g;float textureNoiseDisp1=mix(textureSampleR1-0.5,textureSampleG1-0.5,(sin(time+uCumulativeAudio.a*2.0)+1.0)*0.5)*textureNoiseStrength;textureUv+=vec2(272.861,829.937+uCumulativeAudio.y*0.1);textureUv+=vec2(180.302-uCumulativeAudio.z*0.1,819.871);float textureSampleR3=texture(uTextureNoise,textureUv).r;float textureSampleG3=texture(uTextureNoise,vec2(textureUv.x,1.0-textureUv.y)).g;float textureNoiseDisp3=mix(textureSampleR3-0.5,textureSampleG3-0.5,(sin(time+uCumulativeAudio.a*2.0)+1.0)*0.5)*textureNoiseStrength;uv+=textureNoiseDisp0;vec2 st=uv*noiseScale;vec2 q=vec2(0.0);q.x=fbm(st*0.5+windSpeed*(time+uCumulativeAudio.a*0.175*overallSoundScale));q.y=fbm(st*0.5+windSpeed*(time+uCumulativeAudio.x*0.136*overallSoundScale));vec2 r=vec2(0.0);r.x=fbm(st+1.0*q+vec2(0.3,9.2)+0.15*(time+uCumulativeAudio.y*0.234*overallSoundScale));r.y=fbm(st+1.0*q+vec2(8.3,0.8)+0.126*(time+uCumulativeAudio.z*0.165*overallSoundScale));float f=fbm(st+r-q);float fullFbm=(f+0.6*f*f+0.7*f+0.5)*0.5;fullFbm=pow(fullFbm,fbmPowerDamping);fullFbm*=fbmStrength;blurRadius=blurRadius*1.5;vec2 snUv=(uv+vec2((fullFbm-0.5)*1.2)+vec2(0.0,0.025)+textureNoiseDisp0)*vec2(layer1Frequency,1.0);float sn=noise(snUv*2.0+vec2(sin(sinOffsets.x*0.25),time*0.5+sinOffsets.x))*2.0*layer1Amplitude;float sn2=smoothstep(sn-1.2*blurRadius,sn+1.2*blurRadius,(snUv.y-0.5*waveSpread)*(5.0-uAudioAverage.x*0.1*overallSoundScale*0.5)+0.5);vec2 snUvBis=(uv+vec2((fullFbm-0.5)*0.85)+vec2(0.0,0.025)+textureNoiseDisp1)*vec2(layer2Frequency,1.0);float snBis=noise(snUvBis*4.0+vec2(sin(sinOffsets.y*0.15)*2.4+293.0,time*1.0+sinOffsets.y*0.5))*2.0*layer2Amplitude;float sn2Bis=smoothstep(snBis-(0.9+uAudioAverage.y*0.4*overallSoundScale)*blurRadius,snBis+(0.9+uAudioAverage.y*0.8*overallSoundScale)*blurRadius,(snUvBis.y-0.6*waveSpread)*(5.0-uAudioAverage.y*0.75)+0.5);vec2 snUvThird=(uv+vec2((fullFbm-0.5)*1.1)+textureNoiseDisp3)*vec2(layer3Frequency,1.0);float snThird=noise(snUvThird*6.0+vec2(sin(sinOffsets.z*0.1)*2.4+153.0,time*1.2+sinOffsets.z*0.8))*2.0*layer3Amplitude;float sn2Third=smoothstep(snThird-0.7*blurRadius,snThird+0.7*blurRadius,(snUvThird.y-0.9*waveSpread)*6.0+0.5);sn2=pow(sn2,0.8);sn2Bis=pow(sn2Bis,0.9);vec3 sinColor;sinColor=blendLinearBurn_13_5(bloopColorMain,bloopColorLow,1.0-sn2);sinColor=blendLinearBurn_13_5(sinColor,mix(bloopColorMain,bloopColorMid,1.0-sn2Bis),sn2);sinColor=mix(sinColor,mix(bloopColorMain,bloopColorHigh,1.0-sn2Third),sn2*sn2Bis);sdf.color=mix(sdf.color,vec4(sinColor,1),args.amount);sdf.distance=mix(sdf.distance,length(adjusted_st)-radius,args.amount);return sdf}float micSdf(vec2 st,float muted){float d=100.0;float strokeWidth=0.03;vec2 elementSize=vec2(0.12,0.26);vec2 elementPos=vec2(0.0,elementSize.y*0.585);float element=sdRoundedBox(st-elementPos,elementSize,vec4(min(elementSize.x,elementSize.y)));element=element-strokeWidth;d=min(d,element);vec2 standSize=elementSize*2.2;vec2 standPos=vec2(elementPos.x,elementPos.y-0.05);st.y+=0.08;float ta=-pi/2.0;float tb=pi/2.0;float w=0.0;float stand=sdArc(st-standPos,vec2(sin(ta),cos(ta)),vec2(sin(tb),cos(tb)),standSize.x,w);stand=min(stand,sdSegment(st-standPos,vec2(standSize.x,0.06),vec2(standSize.x,0.0)));stand=min(stand,sdSegment(st-standPos,vec2(-standSize.x,0.06),vec2(-standSize.x,0.0)));float foot=sdSegment(st-standPos,vec2(0.0,-standSize.x),vec2(0.0,-standSize.x*1.66));foot=min(foot,sdSegment(st-standPos,vec2(-standSize.x*0.68,-standSize.x*1.66),vec2(standSize.x*0.68,-standSize.x*1.66)));stand=min(stand,foot);d=min(d,abs(stand)-strokeWidth);return d}ColoredSDF applyBottomAlignedBarsAndMicState(ColoredSDF sdf,SDFArgs args,vec4 avgMag,float micLevel,bool isDarkMode){float d=1000.0;int barCount=5;int loopCount=barCount;if(args.amount==0.0){loopCount=1}for(int i=0;i<loopCount;i++){float f=float(float(i)+0.5)/float(barCount);float w=1.0/float(barCount)*0.42;float h=w;float entryDuration=1.8;float entryAnimation=fixedSpring(scaled(0.0,entryDuration,args.duration),0.94)*args.amount;vec2 pos=vec2(f-0.5,0.0)*args.mainRadius*1.9;pos.x*=entryAnimation;if(i==0){float micScale=mix(6.0-micLevel*2.0,6.0,args.amount);float yOffset=w*2.0;d=micSdf((args.st-pos+vec2(-w*0.15*args.amount,yOffset))*micScale,1.0-args.amount)/micScale}else{h+=avgMag[i-1]*(0.1+(1.0-abs(f-0.5)*2.0)*0.1)*0.7;h=mix(w,h,smoothstep(0.8,1.0,entryAnimation));float bubbleInDur=0.5;float bubbleOutDur=0.4;float bubbleEffect=fixedSpring(scaled(f/4.0,f/4.0+bubbleInDur,args.duration-entryDuration/8.0),1.0)*pow(1.0-scaled(f/8.0+bubbleInDur/8.0,f/4.0+bubbleInDur/8.0+bubbleOutDur,args.duration-entryDuration/8.0),2.0);h+=bubbleEffect*min(h,w);w*=args.amount;h*=args.amount;h=min(h,0.23);pos.y-=0.25;pos.y+=h;pos.y+=bubbleEffect*w*0.5;float dd=sdRoundedBox(args.st-pos,vec2(w,h),vec4(w));d=min(d,dd)}}sdf.distance=d;sdf.color=mix(sdf.color,isDarkMode?vec4(1.0):vec4(0.0,0.0,0.0,1.0),args.amount);return sdf}ColoredSDF applyHaltState(ColoredSDF sdf,SDFArgs args){float radius=mix(0.4,mix(0.4,0.45,args.amount),sin(args.time*0.25)*0.5+0.5);float strokeWidth=mix(radius/2.0,0.02,args.amount);radius-=strokeWidth;radius*=mix(0.7,1.0,args.amount);float circle=abs(length(args.st)-radius)-strokeWidth;sdf.distance=mix(sdf.distance,circle,args.amount);sdf.color.a=mix(sdf.color.a,pow(0.8,2.2),scaled(0.5,1.0,args.amount));return sdf}vec3 blendNormal(vec3 base,vec3 blend){return blend}vec3 blendNormal(vec3 base,vec3 blend,float opacity){return blendNormal(base,blend)*opacity+base*(1.0-opacity)}in vec2 out_uv;out vec4 fragColor;layout(std140)uniform BlorbUniformsObject{float time;float micLevel;float touchDownTimestamp;float touchUpTimestamp;float stateListen;float listenTimestamp;float stateThink;float thinkTimestamp;float stateSpeak;float speakTimestamp;float readyTimestamp;float stateHalt;float haltTimestamp;float stateFailedToConnect;float failedToConnectTimestamp;vec4 avgMag;vec4 cumulativeAudio;vec2 viewport;float screenScaleFactor;float silenceAmount;float silenceTimestamp;bool isDarkMode;bool fadeBloopWhileListening;bool isNewBloop;bool isAdvancedBloop;vec3 bloopColorMain;vec3 bloopColorLow;vec3 bloopColorMid;vec3 bloopColorHigh}ubo;uniform sampler2D uTextureNoise;void main(){vec2 st=out_uv-0.5;float viewRatio=ubo.viewport.y/ubo.viewport.x;st.y*=viewRatio;ColoredSDF sdf;sdf.distance=1000.0;sdf.color=vec4(1.0);SDFArgs args;args.st=st;args.time=ubo.time;args.mainRadius=0.49;SDFArgs idleArgs=args;SDFArgs listenArgs=args;SDFArgs thinkArgs=args;SDFArgs speakArgs=args;SDFArgs haltArgs=args;SDFArgs failedToConnectArgs=args;idleArgs.amount=1.0;listenArgs.amount=ubo.stateListen;thinkArgs.amount=ubo.stateThink;speakArgs.amount=ubo.stateSpeak;haltArgs.amount=ubo.stateHalt;failedToConnectArgs.amount=ubo.stateFailedToConnect;idleArgs.duration=ubo.time-ubo.readyTimestamp;listenArgs.duration=ubo.time-ubo.listenTimestamp;thinkArgs.duration=ubo.time-ubo.thinkTimestamp;speakArgs.duration=ubo.time-ubo.speakTimestamp;haltArgs.duration=ubo.time-ubo.haltTimestamp;failedToConnectArgs.duration=ubo.time-ubo.failedToConnectTimestamp;if(ubo.isNewBloop){sdf=applyIdleState(sdf,idleArgs,ubo.isDarkMode)}else{sdf=applyIdleStateLegacy(sdf,idleArgs,ubo.isDarkMode)}if(failedToConnectArgs.amount>0.0){sdf=applyHaltState(sdf,failedToConnectArgs)}if(listenArgs.amount>0.0){if(ubo.isAdvancedBloop){if(speakArgs.amount>0.0){listenArgs.amount=1.0}int binCount=1;sdf=applyListenAndSpeakState(sdf,listenArgs,ubo.micLevel,ubo.avgMag,ubo.cumulativeAudio,binCount,ubo.bloopColorMain,ubo.bloopColorLow,ubo.bloopColorMid,ubo.bloopColorHigh,uTextureNoise,true,ubo.isAdvancedBloop)}else{sdf=applyListenState(sdf,listenArgs,ubo.micLevel,ubo.listenTimestamp,ubo.touchDownTimestamp,ubo.touchUpTimestamp,ubo.fadeBloopWhileListening)}}if(thinkArgs.amount>0.0){sdf=applyThinkState(sdf,thinkArgs)}if(speakArgs.amount>0.0){if(ubo.isAdvancedBloop){int binCount=1;sdf=applyListenAndSpeakState(sdf,speakArgs,ubo.micLevel,ubo.avgMag,ubo.cumulativeAudio,binCount,ubo.bloopColorMain,ubo.bloopColorLow,ubo.bloopColorMid,ubo.bloopColorHigh,uTextureNoise,false,ubo.isAdvancedBloop)}else{float silenceDuration=ubo.time-ubo.silenceTimestamp;sdf=applySpeakState(sdf,speakArgs,ubo.avgMag,ubo.silenceAmount,silenceDuration)}}if(haltArgs.amount>0.0){sdf=applyHaltState(sdf,haltArgs)}float clampingTolerance=0.0075/ubo.screenScaleFactor;float clampedShape=smoothstep(clampingTolerance,0.0,sdf.distance);float alpha=sdf.color.a*clampedShape;if(!ubo.isNewBloop){alpha*=scaled(0.0,1.0,ubo.time)}fragColor=vec4(sdf.color.rgb*alpha,alpha)}`,Ii=`#version 300 es out vec4 out_position;out vec2 out_uv;const vec4 blitFullscreenTrianglePositions[6]=vec4[](vec4(-1.0,-1.0,0.0,1.0),vec4(3.0,-1.0,0.0,1.0),vec4(-1.0,3.0,0.0,1.0),vec4(-1.0,-1.0,0.0,1.0),vec4(3.0,-1.0,0.0,1.0),vec4(-1.0,3.0,0.0,1.0));void main(){out_position=blitFullscreenTrianglePositions[gl_VertexID];out_uv=out_position.xy*0.5+0.5;out_uv.y=1.0-out_uv.y;gl_Position=out_position}`;class Je{#o;#a;#e;#r=[];#i={};#n;#t;static#s="BlorbUniformsObject";constructor(n,t){this.#e=n;const o=n.getUniformBlockIndex(t,Je.#s),r=n.getActiveUniformBlockParameter(t,o,n.UNIFORM_BLOCK_DATA_SIZE);(this.#n=n.createBuffer()),n.bindBuffer(n.UNIFORM_BUFFER,this.#n),n.bufferData(n.UNIFORM_BUFFER,r,n.DYNAMIC_DRAW);const i=0;n.bindBufferBase(n.UNIFORM_BUFFER,i,this.#n),n.uniformBlockBinding(t,o,i);const a=n.getActiveUniformBlockParameter(t,o,n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES);(this.#r=[]),(this.#i={});for(let s=0;s<a.length;s++){const c=a[s],u=n.getActiveUniform(t,c);if(!u)throw new Error("No uniformInfo for index "+c);let f=u.name;f=f.replace(/\[0\]$/,"");const m=n.getActiveUniforms(t,[c],n.UNIFORM_OFFSET)[0];this.#r.push(f),(this.#i[f]=m)}(this.#t=new ArrayBuffer(r)),(this.#o=new Float32Array(this.#t)),(this.#a=new Int32Array(this.#t))}setVariablesAndRender(n){for(const t of this.#r){const[,o]=t.split("."),i=this.#i[t]/4,a=n[o];typeof a=="number"?(this.#o[i]=a):typeof a=="boolean"?(this.#a[i]=a?1:0):Array.isArray(a)&&this.#o.set(a,i)}this.#e.bindBuffer(this.#e.UNIFORM_BUFFER,this.#n),this.#e.bufferSubData(this.#e.UNIFORM_BUFFER,0,this.#t),this.#e.drawArrays(this.#e.TRIANGLE_STRIP,0,6)}}function P(e){const n=e.replace("#",""),t=parseInt(n.substring(0,2),16)/255,o=parseInt(n.substring(2,4),16)/255,r=parseInt(n.substring(4,6),16)/255;return new Float32Array([t,o,r])}const re={BLUE:{bloopColorMain:P("#DCF7FF"),bloopColorLow:P("#0181FE"),bloopColorMid:P("#A4EFFF"),bloopColorHigh:P("#FFFDEF")},DARK_BLUE:{bloopColorMain:P("#DAF5FF"),bloopColorLow:P("#0066CC"),bloopColorMid:P("#2EC6F5"),bloopColorHigh:P("#72EAF5")},GREYSCALE:{bloopColorMain:P("#D7D7D7"),bloopColorLow:P("#303030"),bloopColorMid:P("#989898"),bloopColorHigh:P("#FFFFFF")},WHITE:{bloopColorMain:P("#FFFFFF"),bloopColorLow:P("#FFFFFF"),bloopColorMid:P("#FFFFFF"),bloopColorHigh:P("#FFFFFF")},BLACK:{bloopColorMain:P("#000000"),bloopColorLow:P("#000000"),bloopColorMid:P("#000000"),bloopColorHigh:P("#000000")},},Mi=({isAdvanced:e,overrideColor:n})=>{const t=Pn();return n&&re[n]?re[n]:e?re.BLUE:t?re.WHITE:re.BLACK};function Pi(){let e=null,n,t=0;const o=350;let r;const i=(s,c,u)=>s+(c-s)*u,a=(s,c)=>{if(s.length!==c.length)return!1;for(let u=0;u<s.length;u++)if(s[u]!==c[u])return!1;return!0};return function(c){const u=performance.now();if(!e)return((n={bloopColorMain:new Float32Array(c.bloopColorMain),bloopColorLow:new Float32Array(c.bloopColorLow),bloopColorMid:new Float32Array(c.bloopColorMid),bloopColorHigh:new Float32Array(c.bloopColorHigh),}),(e={bloopColorMain:new Float32Array(c.bloopColorMain),bloopColorLow:new Float32Array(c.bloopColorLow),bloopColorMid:new Float32Array(c.bloopColorMid),bloopColorHigh:new Float32Array(c.bloopColorHigh),}),(t=u),(r=n),r);let f=!1;const m=["bloopColorMain","bloopColorLow","bloopColorMid","bloopColorHigh"];for(const h of m)if(!a(c[h],e[h])){f=!0;break}f&&((n={bloopColorMain:new Float32Array(r.bloopColorMain),bloopColorLow:new Float32Array(r.bloopColorLow),bloopColorMid:new Float32Array(r.bloopColorMid),bloopColorHigh:new Float32Array(r.bloopColorHigh),}),(t=u),(e={bloopColorMain:new Float32Array(c.bloopColorMain),bloopColorLow:new Float32Array(c.bloopColorLow),bloopColorMid:new Float32Array(c.bloopColorMid),bloopColorHigh:new Float32Array(c.bloopColorHigh),}));let b=(u-t)/o;b>1&&(b=1);const d={bloopColorMain:new Float32Array(n.bloopColorMain.length),bloopColorLow:new Float32Array(n.bloopColorLow.length),bloopColorMid:new Float32Array(n.bloopColorMid.length),bloopColorHigh:new Float32Array(n.bloopColorHigh.length),};for(const h of m){const p=n[h].length;for(let g=0;g<p;g++){const v=n[h][g],y=c[h][g];d[h][g]=i(v,y,b)}}return(r=d),d}}const xn=[300,300],Ri={bands:4,loPass:0,hiPass:400},Fi=(e)=>{const n=(t)=>{let i=1-(Math.max(-100,Math.min(-10,t))*-1)/100;return(i=Math.sqrt(i)),i};return e.map((t)=>(t===-1/0?0:n(t)))};function St(e,n){const[t,o]=l.useState([]),r=l.useRef(void 0);return(l.useEffect(()=>{if(!e)return;if(!r.current){const m=new AudioContext(),b=m.createMediaElementSource(e),d=m.createAnalyser();b.connect(d),d.connect(m.destination),(r.current={audioContext:m,mediaElementAudioSourceNode:b,analyserNode:d})}const{analyserNode:i,audioContext:a}=r.current,s=i?.frequencyBinCount??0,c=new Float32Array(s),f=setInterval(()=>{if(!i)return;i.getFloatFrequencyData(c);let m=c.slice(n.loPass,n.hiPass);const b=Fi(m),d=Math.ceil(b.length/n.bands),h=[];for(let p=0;p<n.bands;p++){const g=b.slice(p*d,(p+1)*d).reduce((v,y)=>v+y,0);h.push(g/d)}o(h)},n.updateInterval);return()=>{clearInterval(f),a&&a.close()}},[e,n.bands,n.hiPass,n.loPass,n.updateInterval]),t)}const Li=(e)=>{const n=St(e,{bands:Xe,updateInterval:ke,loPass:0,hiPass:400,analyserOptions:{fftSize:ht}});return n.length===0?mt:n},Ni=(e,n)=>{const t=Li(e),o=gt(t,{sampleRate:bt,binCount:n.bins,bandCount:n.bands,gainMultipliers:n.gainMultipliers}),r=Ke({magnitudes:t,binCount:1,gainMultiplier:1});return{bandMagnitudes:o,cumulativeMagnitude:r}},Oi=(e)=>{const[n,t]=l.useState({audioData:[0,0,0,0],cumulativeAudioData:[0,0,0,0]}),o=l.useRef([0,0,0,0]),r=l.useRef(void 0),i=l.useRef(performance.now()),{bandMagnitudes:a,cumulativeMagnitude:s}=Ni(e,{bands:3,bins:1,gainMultipliers:[10,1,1]});o.current=[...a,s].flat();const c=l.useCallback(()=>{const u=performance.now(),f=(u-i.current)/1e3;i.current=u;const m=o.current,{audioData:b,cumulativeAudioData:d}=n,h=pi({deltaTimeS:f,audioDataRaw:m,prevAudioData:b,prevCumulativeAudioData:d});t(h)},[n]);return(l.useEffect(()=>(r.current||(r.current=window.setInterval(c,ke)),()=>{clearInterval(r.current),(r.current=void 0)}),[c]),n)},Cn=Promise.resolve();function wt({url:e,readyToPlay:n}){const t=l.useRef(void 0),o=l.useRef(Cn);return(l.useEffect(()=>(t.current||(t.current=document.createElement("audio")),()=>{o.current.then(()=>{t.current&&(t.current.pause(),t.current.removeAttribute("src"),t.current.remove(),(o.current=Cn))})}),[]),l.useEffect(()=>{e&&t.current&&t.current.src!==e&&n&&o.current.then(()=>{t.current&&((t.current.crossOrigin="anonymous"),(t.current.src=e),(o.current=t.current.play()))})},[n,e]),t.current)}function Ui({className:e,url:n}){const[t,o]=l.useState(!1),r=wt({url:n,readyToPlay:t}),i=St(r,Ri),a=l.useMemo(()=>[0,0,0,0],[]);return w.jsx(xt,{className:e,isAdvanced:!1,avgMag:i,cumulativeAudioData:a,onRenderComplete:()=>o(!0)})}function zi({className:e,url:n,overrideColor:t}){const[o,r]=l.useState(!1),i=wt({url:n,readyToPlay:o}),a=Oi(i),{audioData:s,cumulativeAudioData:c}=a;return w.jsx(xt,{className:e,isAdvanced:!0,overrideColor:t,avgMag:s,cumulativeAudioData:c,onRenderComplete:()=>r(!0)})}const xt=({className:e,avgMag:n,cumulativeAudioData:t,isAdvanced:o,overrideColor:r,onRenderComplete:i})=>{const a=Pn(),s=l.useMemo(()=>performance.now()/1e3,[]),c=l.useMemo(()=>performance.now()/1e3,[]),u=l.useRef(void 0),f=l.useRef(Pi()),[m,b]=l.useState(xn),{canvasSizeRef:d,handleCanvasSizeUpdate:h}=oo(xn),p=l.useCallback((k)=>{b([k.width,k.height])},[]),[g,v]=l.useState(performance.now()/1e3);l.useEffect(()=>{const k=setInterval(()=>{v(performance.now()/1e3)},ke);return()=>clearInterval(k)},[]);const y=Mi({isAdvanced:o,overrideColor:r}),S=f.current(y),_=Wr({viewport:m,canvasSize:d.current,shouldMeasurePerf:!0,source:"VoicePicker"}),x=Yr({shouldCalibrate:!0,viewport:m,initialScale:1});return((u.current={time:g,micLevel:0,stateListen:0,listenTimestamp:0,stateThink:0,thinkTimestamp:0,stateSpeak:1,speakTimestamp:c,readyTimestamp:s,stateHalt:0,haltTimestamp:0,touchDownTimestamp:0,touchUpTimestamp:0,stateFailedToConnect:0,failedToConnectTimestamp:0,avgMag:n,cumulativeAudio:t,isNewBloop:!0,isAdvancedBloop:o,bloopColorMain:Array.from(S.bloopColorMain),bloopColorLow:Array.from(S.bloopColorLow),bloopColorMid:Array.from(S.bloopColorMid),bloopColorHigh:Array.from(S.bloopColorHigh),isDarkMode:a,screenScaleFactor:window.devicePixelRatio,viewport:m,silenceAmount:0,silenceTimestamp:0,fadeBloopWhileListening:!1,}),w.jsx(hi,{className:ae("flex items-center justify-center",e),variablesRef:u,onViewportUpdate:p,onRenderComplete:i,textureImage:yt,textureName:"uTextureNoise",onGlAvailable:_,onCanvasSizeUpdate:h,scale:x,GLUniformsSetter:Je,vert:Ii,frag:Di,}))};